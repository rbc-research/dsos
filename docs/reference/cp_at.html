<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Dataset Shift via Class Probabilities — cp_at • dsos</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/journal/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Dataset Shift via Class Probabilities — cp_at"><meta property="og:description" content="Test for no adverse shift via class probabilities for two-sample comparison.
The scores are out-of-bag predictions from random forests with the package
ranger. The prefix cp stands for class probability, whether
the instance belongs to the training or test set. The probability of
belonging to the test set is the relevant notion of outlyingness."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dsos</a>
        <span class="version label label-info" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/diy-score.html">Bring Your Own Scores</a>
    </li>
    <li>
      <a href="../articles/motivation.html">A 10-minute Crash Course</a>
    </li>
    <li>
      <a href="../articles/dependencies.html">Acknowledgements</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/vathymut/dsos/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Dataset Shift via Class Probabilities</h1>
    <small class="dont-index">Source: <a href="https://github.com/vathymut/dsos/blob/HEAD/R/score-class-probability.R" class="external-link"><code>R/score-class-probability.R</code></a></small>
    <div class="hidden name"><code>cp_at.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Test for no adverse shift via class probabilities for two-sample comparison.
The scores are out-of-bag predictions from random forests with the package
<span class="pkg">ranger</span>. The prefix <em>cp</em> stands for class probability, whether
the instance belongs to the training or test set. The probability of
belonging to the test set is the relevant notion of outlyingness.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">cp_at</span><span class="op">(</span><span class="va">x_train</span>, <span class="va">x_test</span>, R <span class="op">=</span> <span class="fl">1000</span>, num_trees <span class="op">=</span> <span class="fl">500</span>, sub_ratio <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x_train</dt>
<dd><p>Training sample.</p></dd>


<dt>x_test</dt>
<dd><p>Test sample.</p></dd>


<dt>R</dt>
<dd><p>The number of permutations. May be ignored.</p></dd>


<dt>num_trees</dt>
<dd><p>The number of trees in random forests.</p></dd>


<dt>sub_ratio</dt>
<dd><p>Subsampling ratio for sample splitting. May be ignored.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A named list or object of class <code>outlier.test</code> containing:</p><ul><li><p><code>statistic</code>: observed WAUC statistic</p></li>
<li><p><code>seq_mct</code>: sequential Monte Carlo test, if applicable</p></li>
<li><p><code>p_value</code>: p-value</p></li>
<li><p><code>outlier_scores</code>: outlier scores from training and test set</p></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p>The suffix <em>at</em> refers to the asymptotic test statistic. This variant
uses the asymptotic null distribution for the weighted AUC (WAUC), the test
statistic. Li &amp; Fine (2010) derives its null distribution. This approximation
is reliable in large sample; otherwise, prefer permutations for inference.
The example below uses datasets with small samples, which is generally not
advisable, is for illustration only.</p>
    </div>
    <div id="notes">
    <h2>Notes</h2>
    

<p>Please see references for the classifier two-sample test, the
inspiration behind this approach. Note that Ciemencon et al. (2009) uses
both sample splitting for inference and the AUC, rather than the WAUC. Most
supervised method for binary classification can replace random forests, the
default in this implementation.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Kamulete, V. M. (2022). 
<em>Test for non-negligible adverse shifts</em>.
In Uncertainty in Artificial Intelligence. PMLR.</p>
<p>Ciemencon, S., Depecker, M., &amp; Vayatis, N. (2009, December).
<em>AUC optimization and the two-sample problem</em>.
In Proceedings of the 22nd International Conference on Neural Information Processing Systems (pp. 360-368).</p>
<p>Lopez-Paz, D., &amp; Oquab, M. (2016).
<em>Revisiting classifier two-sample tests</em>.
arXiv preprint arXiv:1610.06545.</p>
<p>Friedman, J. (2004).
<em>On multivariate goodness-of-fit and two-sample testing</em>.</p>
<p>Gandy, A. (2009).
<em>Sequential implementation of Monte Carlo tests with uniformly bounded resampling risk</em>.
Journal of the American Statistical Association, 104(488), 1504-1511.</p>
<p>Li, J., &amp; Fine, J. P. (2010).
<em>Weighted area under the receiver operating characteristic curve and its application to gene selection</em>.
Journal of the Royal Statistical Society: Series C (Applied Statistics), 59(4), 673-692.</p>
<p>Rinaldo, A., Wasserman, L., &amp; G'Sell, M. (2019).
<em>Bootstrapping and sample splitting for high-dimensional, assumption-lean inference</em>.
Annals of Statistics, 47(6), 3438-3469.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>[cp_ss()] for asymptotic p-value via sample splitting.
[cp_pt()] for p-value approximation via permutations.</p>
<p>Other classifiers: 
<code><a href="cp_pt.html">cp_pt</a>()</code>,
<code><a href="cp_ss.html">cp_ss</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/vathymut/dsos" class="external-link">dsos</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">12345</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x_train</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="co"># Training sample: Species == 'setosa'</span></span></span>
<span class="r-in"><span><span class="va">x_test</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span><span class="fl">51</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="co"># Test sample: Species == 'versicolor'</span></span></span>
<span class="r-in"><span><span class="va">iris_test</span> <span class="op">&lt;-</span> <span class="fu">cp_at</span><span class="op">(</span><span class="va">x_train</span>, <span class="va">x_test</span><span class="op">)</span> <span class="co"># Can also use: cp_ss and cp_pt</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">iris_test</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ statistic     : num 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ p_value       : num 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ outlier_scores:List of 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ train: num [1:50] 0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ test : num [1:50] 1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - attr(*, "class")= chr "outlier.test"</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Vathy M. Kamulete.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

